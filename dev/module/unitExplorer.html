<!--

Author: Charles Perin

2018, Apr 20

-->

<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>unitExplorer</title>

    <script src="../lib/jquery-3.3.1.min.js"></script>
    <script src="../lib/d3.v5.min.js"></script>
    <script src="../lib/d3-selection-multi.v1.min.js"></script>
    <script src="./Utils.js"></script>
    <script src="./constants.js"></script>
    <script src="./unitExplorer.js"></script>


</head>

<body>

<div id="main">

  <div id="unitExplorer">


  </div>

</div>


<script>
    /*
     init function starting when the document is ready
     */
    $(document).ready(function(){

        let unitExplorer = new UnitExplorer({
          parent: "#unitExplorer",
          unitCols: 2,
          unitWidth: constants.unitDimensions.width,
          unitHeight: constants.unitDimensions.height,
          unitMargin: {top: 5, right: 5, bottom: 5, left: 5},
          layout: {
            left: {
              width: 50,
              margin: {top: 0, right: 0, bottom: 0, left: 0}
            },
            top: {
              height: 15,
              margin: {top: 0, right: 0, bottom: 5, left: 0}
            },
            bottom: {
              height: 15,
              margin: {top: 0, right: 0, bottom: 0, left: 0}
            }
          },
          unitFilter: function(d){

            let activities = d3.sum(d.timeseries, t => t.activity_count);
            let domestic = d3.sum(d.timeseries, t => t.domestic_count);
            let places = d3.sum(d.timeseries, t => t.place_mentioned_count);
            let persons = d3.sum(d.timeseries, t => t.person_count);

            let activitiesMax = d3.max(d.timeseries, t => t.activity_count);
            let domesticMax = d3.max(d.timeseries, t => t.domestic_count);
            let placesMax = d3.max(d.timeseries, t => t.place_mentioned_count);
            let personsMax = d3.max(d.timeseries, t => t.person_count);

            //console.log(activities, domestic, places, persons);
            if(activities < constants.unitFilter.minActivities){
                //console.log(`Skip Unit ${d.unit} because less activities than ${minActivities}`);
                return false;
            }
            if(domestic < constants.unitFilter.minDomestic){
              return false;
            }
            if(places < constants.unitFilter.minPlaces){
                return false;
            }
            if(persons < constants.unitFilter.minPersons){
              return false;
            }

            if(activitiesMax > constants.unitFilter.maxActivitiesADay){
              return false;
            }
            if(domesticMax > constants.unitFilter.maxDomesticADay){
              return false;
            }
            if(placesMax > constants.unitFilter.maxPlacesADay){
              return false;
            }
            if(personsMax > constants.unitFilter.maxPersonsADay){
              return false;
            }

            return true;
          },
          dataFilter: function(d){
            if(d.date > constants.parseYYYMMDD("1910-01-01") && d.date < constants.parseYYYMMDD("1920-01-01")) return true;
            console.log("Skipping entry with invalid date: ",d);
            return false;
          }
        });


        unitExplorer.loadDataFile(`./../data/unitStatistics/2018-20-04/${constants.fileName}.json`, function(){
          console.log(unitExplorer.units);

          unitExplorer.init("#unitExplorer");
        });




    });


</script>


</body>
</html>
